<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>数学研究部 | Math Club</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.min.js"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      font-family: sans-serif;
      background: white;
      overflow-x: hidden;
    }

    nav {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background: #111;
      color: white;
      padding: 12px 24px;
      z-index: 999;
      font-size: 18px;
      display: flex;
      gap: 20px;
      font-family:  "Noto Serif JP", serif; /* ← ここ追加！ */
    }

    nav a {
      color: white;
      text-decoration: none;
    }

    body {
      padding-top: 70px;
    }

    #content {
      position: relative;
      z-index: 1;
      background: transparent;
      padding: 40px;
    }

    canvas {
      position: fixed;
      top: 0;
      left: 0;
    }
  </style>
</head>
<body>
  <nav>
    <a href="index.html">Home</a>
    <a href="schedule.html">Schedule</a>
    <a href="contact.html">Contact</a>
    <a href="qa.html">Q&A</a>
  </nav>
<!-- Google Fonts 読み込み -->
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP&display=swap" rel="stylesheet">

<!-- 明朝体のテキスト -->
<style>
  .corner-message {
    position: fixed;
    top: 72px;
    left: 20px;
    font-size: 20px;
    color: #111;
    font-weight: normal;
    z-index: 10;
    pointer-events: none;
    font-family: "Noto Serif JP", serif;
  }
</style>

<div class="corner-message">京都府立医科大学 数学研究部 公式HP</div>
  <style>
  .corner-message {
    position: fixed;
    top: 72px; /* ナビバー下に配置 */
    left: 20px;
    font-size: 20px;
    color: #111;
    font-weight: bold;
    z-index: 10;
    pointer-events: none;
  }
</style>

<div class="corner-message">京都府立医科大学 数学研究部 公式HP</div>
<!--
<div id="content">
  <h1>数学研究部</h1>
  <p>Welcome to the Math Club!</p>
</div>
-->
  <!-- 三角タイル背景 -->
<script>
  new p5(p => {
    const sideLength = 60;
    const walkerCount = 48;
    let triangles = [];
    let points = [];
    let adjacency = new Map();
    let walkers = [];

 p.setup = () => {
  const height = Math.max(
    document.body.scrollHeight,
    document.documentElement.scrollHeight
  );
  const cnv = p.createCanvas(p.windowWidth, height);
  cnv.position(0, 0);
  cnv.style('z-index', '-10');
  cnv.style('pointer-events', 'none');

  generateTriangleGrid(); // ← 初期生成

  if (points.length === 0) {
    console.error("pointsが空です！");
  }

  for (let i = 0; i < walkerCount; i++) {
    walkers.push(new Walker());
  }
};

p.draw = () => {
  p.background(255); // 背景を白で塗りつぶし

  // 三角タイルを描く（波なし）
  p.noFill();
  p.stroke(0, 40);
  for (let t of triangles) {
    p.beginShape();
    for (let pt of t) {
      p.vertex(pt.x, pt.y);
    }
    p.endShape(p.CLOSE);
  }

  // 点の描画（発光・移動あり）
  for (let w of walkers) {
    w.update();
    w.display();
  }
};
function generateTriangleGrid() {
  const h = sideLength * Math.sqrt(3) / 2;
  triangles = [];
  adjacency.clear();

  for (let y = 0; y < p.height + h; y += h) {
    for (let x = 0; x < p.width + sideLength; x += sideLength) {
      const xOffset = (Math.floor(y / h) % 2) * (sideLength / 2);

      const p1 = p.createVector(x + xOffset, y);
      const p2 = p.createVector(x + sideLength / 2 + xOffset, y + h);
      const p3 = p.createVector(x - sideLength / 2 + xOffset, y + h);

      triangles.push([p1, p2, p3]);

      registerEdge(p1, p2);
      registerEdge(p2, p3);
      registerEdge(p3, p1);
    }
  }

  points = Array.from(adjacency.values()).map(obj => obj.vec);
}

    function registerEdge(a, b) {
      const keyA = a.x + ',' + a.y;
      const keyB = b.x + ',' + b.y;

      if (!adjacency.has(keyA)) adjacency.set(keyA, { vec: a, neighbors: [] });
      if (!adjacency.has(keyB)) adjacency.set(keyB, { vec: b, neighbors: [] });

      const neighborsA = adjacency.get(keyA).neighbors;
      const neighborsB = adjacency.get(keyB).neighbors;

      if (!neighborsA.some(n => n.x === b.x && n.y === b.y)) {
        neighborsA.push(adjacency.get(keyB).vec);
      }
      if (!neighborsB.some(n => n.x === a.x && n.y === a.y)) {
        neighborsB.push(adjacency.get(keyA).vec);
      }
    }

    class Walker {
  constructor() {
    this.current = p.random(points);
    this.next = this.chooseNext(this.current);
    this.t = 0;
    this.speed = p.random(0.003, 0.008);
    this.phase = p.random(p.TWO_PI); // ← これが絶対に必要
  }

  chooseNext(current) {
    const key = current.x + ',' + current.y;
    const options = adjacency.get(key)?.neighbors;
    if (!options || options.length === 0) return current;

    let next;
    do {
      next = p.random(options);
    } while (next.x === current.x && next.y === current.y && options.length > 1);
    return next;
  }

  update() {
    this.t += this.speed;
    if (this.t >= 1) {
      this.current = this.next;
      this.next = this.chooseNext(this.current);
      this.t = 0;
    }
  }

  display() {
    const x = p.lerp(this.current.x, this.next.x, this.t);
    const y = p.lerp(this.current.y, this.next.y, this.t);

    const size = 6 + p.sin(p.frameCount * 0.05 + this.phase) * 2;
    const glow = 20 + 10 * p.sin(p.frameCount * 0.08 + this.phase);

    p.noStroke();
    p.fill(0, 0, 0, 25); // 外側ぼかし
    p.ellipse(x, y, size + glow);

    p.fill(0);
    p.ellipse(x, y, size);
  }
}
    p.windowResized = () => {
      const height = document.documentElement.scrollHeight;
      p.resizeCanvas(p.windowWidth, height);
    };
  });
</script>
  <!-- p5.js WebGL 地球（京都に赤ピン） -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.min.js"></script>
<script>
let earthTexture;
let angleX = 0, angleY = 0;
let lastMouseX, lastMouseY;
let dragging = false;

function preload() {
  earthTexture = loadImage("https://upload.wikimedia.org/wikipedia/commons/thumb/c/cb/Earthmap1000x500compac.jpg/800px-Earthmap1000x500compac.jpg");
}

function setup() {
  const canvas = createCanvas(windowWidth, windowHeight, WEBGL);
  canvas.style('position', 'fixed');
  canvas.style('z-index', '-10');
  canvas.style('top', '0');
  canvas.style('left', '0');
  noStroke();
  textureMode(NORMAL);
}

function draw() {
  background(255);
  rotateX(angleX);
  rotateY(angleY);

  // 地球描画
  texture(earthTexture);
  sphere(250);

  // 京都の位置（緯度経度 → ラジアン → xyz）
  const lat = 35.0242;
  const lon = 135.7699;
  const radius = 250;
  const theta = radians(lon);
  const phi = radians(90 - lat);
  const x = radius * sin(phi) * cos(theta);
  const y = radius * cos(phi);
  const z = radius * sin(phi) * sin(theta);

  push();
  translate(x, -y, z);
  fill(255, 0, 0);
  sphere(5); // 赤いピン（小さな球）
  pop();
}

function mousePressed() {
  lastMouseX = mouseX;
  lastMouseY = mouseY;
  dragging = true;
}

function mouseDragged() {
  if (dragging) {
    let dx = mouseX - lastMouseX;
    let dy = mouseY - lastMouseY;
    angleY += dx * 0.01;
    angleX += dy * 0.01;
    lastMouseX = mouseX;
    lastMouseY = mouseY;
  }
}

function mouseReleased() {
  dragging = false;
}

function windowResized() {
  resizeCanvas(windowWidth, windowHeight);
}
</script>
</body>
</html>
