<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Earth</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.min.js"></script>
  </head>
  <body style="margin:0; overflow:hidden;">
    <script>
      new p5((p) => {
        let earthTexture;
        let angleX = 0,
          angleY = 0;
        let lastMouseX,
          lastMouseY,
          dragging = false,
          loaded = false;

        p.preload = () => {
          earthTexture = p.loadImage(
            "https://upload.wikimedia.org/wikipedia/commons/thumb/c/cb/Earthmap1000x500compac.jpg/800px-Earthmap1000x500compac.jpg",
            () => {
              loaded = true;
            }
          );
        };

        p.setup = () => {
          p.createCanvas(p.windowWidth, p.windowHeight, p.WEBGL);
          p.noStroke();
        };

        p.draw = () => {
          if (!loaded) return;
          p.clear();
          p.rotateX(angleX);
          p.rotateY(angleY);
          p.texture(earthTexture);
          p.sphere(250);

          // 京都府立医科大学
          const lat = 35.0242;
          const lon = 135.7699;
          const radius = 250;
          const theta = p.radians(lon);
          const phi = p.radians(90 - lat);
          const x = radius * p.sin(phi) * p.cos(theta);
          const y = radius * p.cos(phi);
          const z = radius * p.sin(phi) * p.sin(theta);

          p.push();
          p.translate(x, -y, z);
          p.fill(255, 0, 0);
          p.sphere(6);
          p.pop();
        };

        p.mousePressed = () => {
          lastMouseX = p.mouseX;
          lastMouseY = p.mouseY;
          dragging = true;
        };

        p.mouseDragged = () => {
          if (dragging) {
            angleY += (p.mouseX - lastMouseX) * 0.01;
            angleX += (p.mouseY - lastMouseY) * 0.01;
            lastMouseX = p.mouseX;
            lastMouseY = p.mouseY;
          }
        };

        p.mouseReleased = () => {
          dragging = false;
        };

        p.windowResized = () => {
          p.resizeCanvas(p.windowWidth, p.windowHeight);
        };
      });
    </script>
  </body>
</html>
